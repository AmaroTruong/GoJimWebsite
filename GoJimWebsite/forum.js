import{initializeApp}from"https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";import{getDatabase,ref,onValue,push,set,serverTimestamp,child,get}from"https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";const firebaseConfig={apiKey:"AIzaSyC3Vuf4ma6wKrrphF7tbmd2ih0Qr28w2sM",authDomain:"gojim-26cbc.firebaseapp.com",projectId:"gojim-26cbc",storageBucket:"gojim-26cbc.appspot.com",messagingSenderId:"491730952662",appId:"1:491730952662:web:2f430530eef2e0ebfbc477",measurementId:"G-C5KT1RZJYS"},app=initializeApp(firebaseConfig),db=getDatabase(app);function displayThreads(e){const t=document.getElementById("threads-container");t.innerHTML="",e.forEach((e=>{const a=e.val(),s=`<div class="thread-container" data-thread-key="${e.key}">\n                        <div class="thread">\n                            <div class="thread-title">${a.title}</div>\n                            <div class="thread-message">${a.message}</div>\n                            <button class="increment-button">+</button>\n                            <p class="counter-value">${a.count}</p>\n                            <button class="decrement-button">-</button>\n                            <button class="reply-btn">Reply</button>\n                            <input type="text" class="reply-textbox" style="display:none">\n                            <button class="submit-reply" style="display:none">Submit</button>\n                                                    <div class="replies"></div>\n                    </div>\n                </div>`;t.insertAdjacentHTML("beforeend",s)})),document.querySelectorAll(".increment-button").forEach((e=>{e.addEventListener("click",(async()=>{const t=e.closest(".thread-container").getAttribute("data-thread-key"),a=ref(db,`threads/${t}/count`),s=(await get(a)).val()+1;await set(a,s)}))})),document.querySelectorAll(".decrement-button").forEach((e=>{e.addEventListener("click",(async()=>{const t=e.closest(".thread-container").getAttribute("data-thread-key"),a=ref(db,`threads/${t}/count`),s=(await get(a)).val()-1;await set(a,s)}))})),document.querySelectorAll(".reply-btn").forEach((e=>{e.addEventListener("click",(()=>{const t=e.closest(".thread"),a=t.querySelector(".reply-textbox"),s=t.querySelector(".submit-reply");a.style.display="none"===a.style.display?"block":"none",s.style.display="none"===s.style.display?"block":"none"}))})),document.querySelectorAll(".submit-reply").forEach((e=>{e.addEventListener("click",(async()=>{const t=e.closest(".thread"),a=t.closest(".thread-container").getAttribute("data-thread-key"),s=t.querySelector(".reply-textbox").value;try{await push(ref(db,`threads/${a}/replies/`),{message:s,timestamp:serverTimestamp()}),alert("Reply submitted"),t.querySelector(".reply-textbox").value="";const e=`\n                        <div class="reply">\n                            <p>${s}</p>\n                        </div>\n                    `;t.querySelector(".replies").insertAdjacentHTML("beforeend",e)}catch(e){alert("Error: "+e.message)}}))})),e.forEach((async(e,t)=>{const a=e.key,s=ref(db,`threads/${a}/replies/`),r=await get(s);if(r.exists()){const e=document.querySelectorAll(".replies")[t];r.forEach((t=>{const a=`\n                        <div class="reply">\n                            <p>${t.val().message}</p>\n                        </div>\n                    `;e.innerHTML+=a}))}}))}window.submitForm=async function(e){e.preventDefault();const t=document.getElementById("thread_title").value,a=document.getElementById("thread_message").value;try{await push(ref(db,"threads/"),{title:t,message:a,timestamp:serverTimestamp(),count:0}),alert("Thread created"),document.getElementById("createThreadForm").reset()}catch(e){alert("Error: "+e.message)}},onValue(ref(db,"threads/"),displayThreads);