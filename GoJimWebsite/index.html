<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>GoJim!</title>
    <link rel="stylesheet" href="main.css">
  </head>
  <body>
    <button id="profileButton">Profile</button>
    <header>
      <h1>Welcome to GoJim!</h1>
    </header>

   <nav>
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="aboutus.html">About</a></li>
    <li><a href="tipspage.html">Tips</a></li>
    <li><a href="Calc.html">Calculators</a></li>
    <li><a href="gymgallery.html">Gallery</a></li>
    <li><a href="contactus.html">Contact Us</a></li>
    <li><a href="createAccount.html">Create an Account</a></li>
    <li><a href="goals.html">Set Goals</a></li>
    <li><a href="forum.html">Forum</a></li>
  </ul>
</nav>
</html>
<script type="module">
  //The import statements reference Firebase documentation to take advantage of Realtime Database, Authentication, and Application Start API's
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-auth.js";
  import {getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";
  
  //Firebase Database; allows us to connect to the cloud database
  const firebaseConfig = {
    apiKey: "AIzaSyC3Vuf4ma6wKrrphF7tbmd2ih0Qr28w2sM",
    authDomain: "gojim-26cbc.firebaseapp.com",
    databaseURL: "https://gojim-26cbc-default-rtdb.firebaseio.com",
    projectId: "gojim-26cbc",
    storageBucket: "gojim-26cbc.appspot.com",
    messagingSenderId: "491730952662",
    appId: "1:491730952662:web:2f430530eef2e0ebfbc477",
    measurementId: "G-C5KT1RZJYS"
  };
  
  // Necessary to utilize the imported modules from Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

// Based on the user's web browser, the instance of userID is retrieved and allows the developer to reference our database
  const storedUserId = localStorage.getItem('userId');
  if (storedUserId) {
  //uses Firebase documentation to connect with our database; try-catches are used to allow the user to understand a sucessful session
    auth.signInWithCustomToken(storedUserId)
      .then(() => console.log('User logged in automatically'))
      .catch((error) => console.log(error));
  }
  //References the profileButton button in the HTML script, upon clicking the button, the user will be logged into the database.
   const profileButton = document.querySelector("#profileButton");
  profileButton.addEventListener('click', async (e) => {
    const user = auth.currentUser;
    if (user) {
      const userId = user.uid;
      //References database to retrieve the email, in correspondence to the user's ID
      const userRef = ref(db, `users/${userId}`);
      const snapshot = await get(child(userRef, 'email'));
      const email = snapshot.val();
      //Blob feature creates a sample HTML, rather than creating a file in the repository, needs to be revised
      const htmlBlob = new Blob([`<!DOCTYPE html>
        <html>
          <head>
          //Styling of the custom page
          <style>
    body {
      background-color: #FFFFFF;
      padding: 20px;
    }
    nav {
      background-color: #CCCCCC;
      padding: 10px;
      margin-bottom: 20px;
    }
    nav ul {
      list-style: none;
      display: flex;
      justify-content: space-between;
    }
    nav ul li {
      margin-right: 20px;
    }
    .slider {
      -webkit-appearance: none;
      width: 100%;
      height: 10px;
      background: #CCCCCC;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
    }
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      background: #333333;
      cursor: pointer;
    }
    .slider::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #333333;
      cursor: pointer;
    }
  </style>
            <title>Personalized Page</title>
          </head>
          <body>
          //Navigational tabs for the custom website
          <nav>
          <ul>
          <li><a href="#threads">Threads</a></li>
          <li><a href="#likes">Likes</a></li>
          <li><a href="#comments">Comments</a></li>
        </ul>
        </nav>
            <h1>Welcome, ${email}!</h1>
            <h2>Profile Picture</h2>
    <button>Upload</button>
     <h2>Background Color</h2>
     //Background color slider that has not been finished
      <input type="range" min="0" max="255" value="128" class="slider" id="bgSlider">
    <script>
    const slider = document.getElementById("bgSlider");
    slider.addEventListener("input", () => {
  const value = slider.value;
  //Hexadecimal value for corresponding collor
  const hexValue = value.toString(16).padStart(2, '0').toUpperCase();
  });
        </body>
        </html>`], { type: 'text/html' });
        //Creates a custom URL that references the HTML blob object created
      const htmlUrl = URL.createObjectURL(htmlBlob);
      //Opens the corresponding Blob object in another tab
      window.open(htmlUrl, '_blank');
    }
  });
</script>
