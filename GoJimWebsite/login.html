<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="">
    </head>
    <body>
    <h1>Login In</h1>
    <form>
        <label for="email">Email:</label>
		<input type="text" id="email" name="email" required><br>
        
        <label for="password">Password:</label>
		<input type="password" id="password" name="password" required><br>

        <button type="button" id="login" name="signin">Sign In</button>

    </form>
    </body>
</html>
<script type="module">
import {initializeApp} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut
    } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
import {getDatabase, set, ref, update} from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";
const firebaseConfig = {
    apiKey: "AIzaSyC3Vuf4ma6wKrrphF7tbmd2ih0Qr28w2sM",
    authDomain: "gojim-26cbc.firebaseapp.com",
    databaseURL: "https://gojim-26cbc-default-rtdb.firebaseio.com",
    projectId: "gojim-26cbc",
    storageBucket: "gojim-26cbc.appspot.com",
    messagingSenderId: "491730952662",
    appId: "1:491730952662:web:2f430530eef2e0ebfbc477",
    measurementId: "G-C5KT1RZJYS"
  };
  
  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const database = getDatabase(app)
  
  const login = document.getElementById('login');

  login.addEventListener('click', (e) => {
    var email = document.getElementById("email").value;
    var password = document.getElementById("password").value;
    
    signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                const user = userCredential.user;
                var lgDate = new Date();
                const userRef = ref(database, 'users/' + user.uid);
                update(ref(database, 'users/' + user.uid), {
                    last_login: lgDate,
                })
                    .then(() => {
                        alert('Welcome!')
                        window.location.href = "index.html"
                    })
                    .catch((error) => {
                        alert(error);
                    });
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                alert(errorMessage);
            });
  });
</script>
